<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">

  <title>SQL</title>
  <meta name="description" content="SQL">
  <meta name="author" content="jason">

  <link rel="stylesheet" type="text/css" href="css/main.css">
  <link rel="stylesheet" type="text/css" href="css/prism.css">
</head>

<body>
	<nav>
   		<ul>
       		<li><a href="/index">Home</a></li>
       		<li><a href="/">SQL</a></li>
   		</ul>
	</nav>
	<div class="container">
   		<div class="blurb">
       		<h1>SEKnFind SQL</h1>
				<p>This is the most interesting and useful fraction of the SEKnFind reports library. Many were taken and adapted from the <a rel="nofollow" class="external text" href="https://wiki.koha-community.org/wiki/SQL_Reports_Library">community SQL Reports Library</a>.</p>
			<h2><span class="mw-headline" id="Tips_.26_Notes">Tips & Notes</span></h2>
			<h3><span class="mw-headline" id="Formatting_notes_fields">Formatting notes fields</span></h3>
				<p>When writing a report, the notes field can include raw HTML. Coupled with in-line styles, emphasis can be placed on the notes. We use this capability to add suggestions and instructions for our libraries to use in conjunction with the reports.</p>
				<p>For example, putting this in the notes field:</p>
					<pre><code class="language-html">&lt;p&gt;Transfers being sent from your library that have not arrived at the other library.&lt;/p&gt;
&lt;p style="color:red;font-weight:bold;"&gt;Suggested action: Check your shelves for these items!&lt;/p&gt;</code></pre>
				<p>Renders as:</p>
					<div class="rendered">
						<p>Transfers being sent from your library that have not arrived at the other library.</p>
						<p style="color:red;font-weight:bold;">Suggested action: Check your shelves for these items!</p>
					</div>	
			<h3><span class="mw-headline" id="Parameters">Parameters</span></h3>
				<p>Parameters allow users to make choices about what info the report retrieves</p>
				<p>Parameter formatting: &lt;&lt;Descriptive text|parameter&gt;&gt;</p>
				<pVanilla Koha parameters:</p>
				<ul>
					<li>Library/Branch: branches</li>
					<li>Shelf Location: LOC</li>
					<li>Item Type: itemtypes</li>
					<li>Collection Code: CCODE</li>
					<li>Lost Status: LOST</li>
					<li>Patron Category: categorycode</li>
					<li>Pop-up Calendar: date</li>
				</ul>
		</div> <!--blurb-->
		<div id="SQL_Reports_Library">
		<h2><span class="mw-headline" id="Reports">Reports</span></h2>
			<h3><span class="mw-headline" id="Acquisitions">Acquisitions</span></h3>
				<h4><span class="mw-headline" id="Newest_items_added_in_a_ccode">Newest items added in a ccode</span></h4>
				<p>Notes: Finds the most recent items added in a collection code within the past year</p>
				<pre><code class="language-sql">SELECT b.title, b.author, b.biblionumber, b.datecreated, i.barcode, i.dateaccessioned
FROM biblio b
LEFT JOIN items i USING (biblionumber)
WHERE i.homebranch = &lt;&lt;Select Library|branches&gt;&gt;
	AND i.ccode = &lt;&lt;Collection Code|CCODE&gt;&gt;
	AND i.dateaccessioned > DATE_SUB(CURDATE(),INTERVAL 1 YEAR)
ORDER BY i.dateaccessioned DESC</code></pre>
				<h4><span class="mw-headline" id="Items_added_in_a_shelf_location_within_a_date_range">Items added in a shelf location within a date range</span></h4>
				<p>Notes: Count of acquisitions in a selected yeah by shelf location</p>
				<pre><code class="language-sql">SELECT authorised_values.lib AS 'Shelving Location', COUNT(1) AS Count
FROM items
LEFT JOIN authorised_values ON (items.location=authorised_values.authorised_value)
WHERE items.homebranch = &lt;&lt;Library|branches&gt;&gt;
	AND items.dateaccessioned BETWEEN &lt;&lt;Start date|date&gt;&gt; AND &lt;&lt;End date|date&gt;&gt;
GROUP BY items.location
LIMIT 100</code></pre>
				<h4><span class="mw-headline" id="Items_added_to_a_shelf_location_within_a_specified_year.2C_summarized_by_month">Items added to a shelf location within a specified year, summarized by month</span></h4>
				<p>Notes: Lists out items added each month for the specified year in the specified shelf location</p>
				<pre><code class="language-sql">SELECT  YEAR(items.dateaccessioned) as year, MONTHNAME(items.dateaccessioned) as month, concat(biblio.title, ' ', ExtractValue((
	SELECT marcxml 
	FROM biblioitems
	WHERE biblio.biblionumber = biblioitems.biblionumber),'//datafield[@tag="245"]/subfield[@code="b"]')) AS FullTitle,
biblio.author, items.itemcallnumber, items.ccode, count(*) as quantity
FROM biblio, items 
WHERE biblio.biblionumber = items.biblionumber 
	AND YEAR(items.dateaccessioned) = &lt;&lt; Enter the year to select (yyyy) &gt;&gt;
	AND items.homebranch = &lt;&lt;Select your library|branches&gt;&gt;  
	AND items.location = &lt;&lt;Shelf Location|LOC&gt;&gt;
GROUP BY  month, FullTitle, items.itemcallnumber
ORDER BY MONTH(items.dateaccessioned), biblio.title</code></pre>
			<h3><span class="mw-headline" id="Administrative">Administrative</span></h3>
				<h4><span class="mw-headline" id="Authorized_values_list">Authorized values list</span></h4>
				<p>Notes: Lists all authorized values and their descriptions</p>
				<pre><code class="language-sql">SELECT authorised_value, id, category, lib
FROM authorised_values
ORDER BY category</code></pre>
				<h4><span class="mw-headline" id="Patrons_with_permissions">Patrons with permissions</span></h4>
				<p>Notes: Lists patrons who have staff permissions</p>
				<pre><code class="language-sql">SELECT  borrowers.cardnumber, borrowers.surname, borrowers.firstname, borrowers.branchcode, borrowers.categorycode, borrowers.flags as 'permissions'
FROM borrowers
WHERE borrowers.branchcode = &lt;&lt;Select your library|branches&gt;&gt; 
	AND borrowers.flags > 0
ORDER BY borrowers.surname asc</code></pre>
				<h4><span class="mw-headline" id="All_Patron_Permissions">All Patron Permissions</span></h4>
				<p>Notes: Lists out which permissions are on and off for each account with permissions</p>
				<pre><code class="language-sql">SELECT surname AS 'Last Name',firstname AS 'First Name',cardnumber AS 'Card Number',categorycode,userid AS 'UserID',branchcode AS 'Library',Super AS 'superlibrarian',A AS 'circulate',SubA AS 'circulate subs',B AS 'catalogue',C AS 'parameters',SubC AS 'parameters subs',D AS 'borrowers',E AS 'permissions',F AS 'reserveforothers',SubF AS 'reserveforothers subs',G AS 'borrow',I AS 'editcatalogue',SubI AS 'editcatalogue subs',J AS 'updatecharges',K AS 'acquisition',SubK AS 'acquisition subs',L AS 'management',M AS 'tools',SubM1 AS 'tools subs (Pt 1)',SubM2 AS 'tools subs (Pt 2)',N AS 'editauthorities',O AS 'serials',SubO AS 'serials subs',P AS 'reports',SubP AS 'reports subs',Q AS 'staffaccess'
FROM (SELECT b.surname,b.firstname,b.cardnumber,b.userid,b.branchcode,b.categorycode,@CHECK:=b.flags AS 'CheckQ',IF(@Check-131072>=0,@Q:='On',@Q:='Off') AS 'Q',
IF(@Check-131072>=0,@CHECK:=@Check-131072,@CHECK) AS 'CheckP',IF(@Check-65536>=0,@P:='On',@P:='Off') AS 'P',(SELECT group_concat(up.code) FROM user_permissions up WHERE up.module_bit='16' AND borrowernumber=b.borrowernumber) AS SubP,
IF(@Check-65536>=0,@CHECK:=@Check-65536,@CHECK) AS 'CheckO',IF(@Check-32768>=0,@O:='On',@O:='Off') AS 'O',(SELECT group_concat(up.code) FROM user_permissions up WHERE up.module_bit='15' AND borrowernumber=b.borrowernumber) AS SubO,
IF(@Check-32768>=0,@CHECK:=@Check-32768,@CHECK) AS 'CheckN',IF(@Check-16384>=0,@N:='On',@N:='Off') AS 'N',
IF(@Check-16384>=0,@CHECK:=@Check-16384,@CHECK) AS 'CheckM',IF(@Check-8192>=0,@M:='On',@M:='Off') AS 'M',(SELECT group_concat(up.code) FROM user_permissions up WHERE up.module_bit='13' AND borrowernumber=b.borrowernumber AND up.code BETWEEN 'a%' AND 'i%') AS SubM1,(SELECT group_concat(up.code) FROM user_permissions up WHERE up.module_bit='13' AND borrowernumber=b.borrowernumber AND up.code BETWEEN 'j%' AND 'z%') AS SubM2,
IF(@Check-8192>=0,@CHECK:=@Check-8192,@CHECK) AS 'CheckL',IF(@Check-4096>=0,@L:='On',@L:='Off') AS 'L',
IF(@Check-4096>=0,@CHECK:=@Check-4096,@CHECK) AS 'CheckK',IF(@Check-2048>=0,@K:='On',@K:='Off') AS 'K',(SELECT group_concat(up.code) FROM user_permissions up WHERE up.module_bit='11' AND borrowernumber=b.borrowernumber) AS SubK,
IF(@Check-2048>=0,@CHECK:=@Check-2048,@CHECK) AS 'CheckJ',IF(@Check-1024>=0,@J:='On',@J:='Off') AS 'J',
IF(@Check-1024>=0,@CHECK:=@Check-1024,@CHECK) AS 'CheckI',IF(@Check-512>=0,@I:='On',@I:='Off') AS 'I',(SELECT group_concat(up.code) FROM user_permissions up WHERE up.module_bit='9' AND borrowernumber=b.borrowernumber) AS SubI,
IF(@Check-512>=0,@CHECK:=@Check-512,@CHECK) AS 'CheckH',IF(@Check-256>=0,@H:='On',@H:='Off') AS 'H',
IF(@Check-256>=0,@CHECK:=@Check-256,@CHECK) AS 'CheckG',IF(@Check-128>=0,@G:='On',@G:='Off') AS 'G',
IF(@Check-128>=0,@CHECK:=@Check-128,@CHECK) AS 'CheckF',IF(@Check-64>=0,@F:='On',@F:='Off') AS 'F',(SELECT group_concat(up.code) FROM user_permissions up WHERE up.module_bit='6' AND borrowernumber=b.borrowernumber) AS SubF,
IF(@Check-64>=0,@CHECK:=@Check-64,@CHECK) AS 'CheckE',IF(@Check-32>=0,@E:='On',@E:='Off') AS 'E',
IF(@Check-32>=0,@CHECK:=@Check-32,@CHECK) AS 'CheckD',IF(@Check-16>=0,@D:='On',@D:='Off') AS 'D',
IF(@Check-16>=0,@CHECK:=@Check-16,@CHECK) AS 'CheckC',IF(@Check-8>=0,@C:='On',@C:='Off') AS 'C',(SELECT group_concat(up.code) FROM user_permissions up WHERE up.module_bit='3' AND borrowernumber=b.borrowernumber) AS SubC,
IF(@Check-8>=0,@CHECK:=@Check-8,@CHECK) AS 'CheckB',IF(@Check-4>=0,@B:='On',@B:='Off') AS 'B',
IF(@Check-4>=0,@CHECK:=@Check-4,@CHECK) AS 'CheckA',IF(@Check-2>=0,@A:='On',@A:='Off') AS 'A',(SELECT group_concat(up.code) FROM user_permissions up WHERE up.module_bit='1' AND borrowernumber=b.borrowernumber) AS SubA,	
IF(@Check-2>=0,@CHECK:=@Check-2,@CHECK) AS 'CheckSuper',IF(@Check>0,'On','Off') AS 'Super'
FROM borrowers b
LEFT JOIN categories USING (categorycode)
WHERE b.flags>0) AS MainFlags
ORDER BY surname, firstname ASC</code></pre>
				<h4><span class="mw-headline" id="Items_added_in_a_year">Items added in a year</span></h4>
				<p>Notes: Count of items added at each library in a selected year based on acquisition date (migration libraries & retros will be inaccurate)</p>
				<pre><code class="language-sql">SELECT i.homebranch, COUNT(*)
FROM items i
WHERE YEAR(i.dateaccessioned) = &lt;&lt;Year&gt;&gt;
AND (i.ccode <> 'PER' AND i.ccode <> 'ILL' AND i.ccode <> 'ROT' OR i.ccode IS NULL)
GROUP BY i.homebranch
ORDER BY i.homebranch
LIMIT 50</code></pre>
				<h4><span class="mw-headline" id="Items_deleted_in_a_year">Items deleted in a year</span></h4>
				<p>Notes: Count of items deleted at each library in a selected year, years prior to migration will be inaccurate</p>
				<pre><code class="language-sql">SELECT homebranch, COUNT(*)
FROM deleteditems
WHERE YEAR(timestamp)=&lt;&lt;Year (YYYY)&gt;&gt;
GROUP BY homebranch
ORDER BY homebranch
LIMIT 50</code></pre>
			<h3><span class="mw-headline" id="Catalog">Catalog</span></h3>
				<h4><span class="mw-headline" id="Contents_of_an_iType">Contents of an iType</span></h4>
				<p>Notes: Lists ALL items in an item type, may be dangerous on high use categories</p>
				<pre><code class="language-sql">SELECT  items.barcode, items.homebranch, items.location, items.itype, items.ccode, biblio.title, biblio.author 
FROM items 
LEFT JOIN biblioitems on (items.biblioitemnumber=biblioitems.biblioitemnumber) 
LEFT JOIN biblio on (biblioitems.biblionumber=biblio.biblionumber)   
WHERE items.itype = &lt;&lt;Item Type|itemtypes&gt;&gt;</code></pre>
				<h4><span class="mw-headline" id="Contents_of_a_Shelf_Location">Contents of a Shelf Location</span></h4>
				<p>Notes: Lists ALL items in a shelf location, may be dangerous on high use categories</p>
				<pre><code class="language-sql">SELECT  items.barcode, items.homebranch, items.holdingbranch, items.location, items.ccode, items.itype, items.itemcallnumber, 
biblioitems.itemtype, biblio.author, biblio.title, items.itemlost, ExtractValue(marcxml,'//datafield[@tag="300"]/subfield[@code>="a"]') AS Description
FROM items
LEFT JOIN biblioitems on (items.biblioitemnumber=biblioitems.biblioitemnumber)
LEFT JOIN biblio on (biblioitems.biblionumber=biblio.biblionumber)
WHERE items.location=&lt;&lt;Select Shelf Location|LOC&gt;&gt;</code></pre>
				<h4><span class="mw-headline" id="Item_count_by_iType">Item count by iType</span></h4>
					<p>Notes: Counts how many items are in each iType at selected library, includes total</p>
				<pre><code class="language-sql">SELECT itemtypes.description AS 'Item Type', COUNT(1) AS Count
FROM items
LEFT JOIN itemtypes ON (items.itype=itemtypes.itemtype)
WHERE items.homebranch = &lt;&lt;Choose Library|branches&gt;&gt;
GROUP BY itemtypes.description
UNION ALL
SELECT 'TOTAL' itype, COUNT(1)
FROM items
WHERE homebranch = &lt;&lt;Choose Library|branches&gt;&gt;</code></pre>
				<h4><span class="mw-headline" id="Item_count_by_shelf_location_.2B_item_type">Item count by shelf location + item type</span></h4>
				<p>Notes: Counts how many items are each combination of shelf location and item type at a library</p>
				<pre><code class="language-sql">SELECT av.lib AS 'Shelving Location', it.description AS 'Item Type', COUNT(1) as Count
FROM items i
LEFT JOIN authorised_values av ON (i.location=av.authorised_value)
LEFT JOIN itemtypes it ON (i.itype=it.itemtype)
WHERE i.homebranch=&lt;&lt;Choose your library|branches&gt;&gt;
GROUP BY i.itype,i.location
ORDER BY it.description, av.lib ASC</code></pre>
				<h4><span class="mw-headline" id="Total_number_of_items_at_each_library">Total number of items at each library</span></h4>
				<p>Notes: Total of each library's holdings</p>
				<pre><code class="language-sql">SELECT homebranch,count(*) as items 
FROM items 
GROUP BY homebranch 
ORDER BY homebranch asc </code></pre>
				<h4><span class="mw-headline" id="Total_number_of_items_at_each_library_excluding_periodicals">Total number of items at each library excluding periodicals</span></h4>
				<p>Notes: Total of each library's holdings, minus periodicals</p>
				<pre><code class="language-sql">SELECT homebranch,count(itemnumber) as items 
FROM items 
WHERE items.ccode <> 'PER'
GROUP BY homebranch 
ORDER BY homebranch asc</code></pre>
				<h4><span class="mw-headline" id="Total_bib_count">Total bib count</span></h4>
				<p>Notes: Number of bibs in the entire collection</p>
				<pre><code class="language-sql">SELECT COUNT(1) as Records
FROM biblio</code></pre>
				<h4><span class="mw-headline" id="Total_item_count">Total item count</span></h4>
				<p>Notes: Number of items in the entire collection</p>
				<pre><code class="language-sql">SELECT COUNT(1) as Items 
FROM items</code></pre>
				<h4><span class="mw-headline" id="Lost_report_.28hyperlinked.29">Lost report (hyperlinked)</span></h4>
				<p>Notes: Modified Items Lost report, includes call# & # of checkouts with links</p>
				<pre><code class="language-sql">SELECT CONCAT('&lt;a href=\"/cgi-bin/koha/catalogue/detail.pl?biblionumber=',biblio.biblionumber,'\"&gt;',title,'&lt/a&gt;') AS Title, biblio.author, authorised_values.lib as 'Lost Code', CONCAT('&lt;a href=\"/cgi-bin/koha/catalogue/moredetail.pl?biblionumber=',biblio.biblionumber,'\"&gt;',barcode,'&lt;/a&gt;') AS Barcode,  items.itemcallnumber,  items.datelastseen, items.price, items.homebranch as 'Library',  items.holdingbranch, items.itemnotes, items.issues as 'Checkouts'
FROM items 
LEFT JOIN biblio on (items.biblionumber = biblio.biblionumber)   
LEFT JOIN authorised_values ON (items.itemlost=authorised_values.authorised_value) 
WHERE  items.homebranch = &lt;&lt;Select your library|branches&gt;&gt;
	AND items.itemlost != 0
	AND authorised_values.category='LOST'
ORDER BY biblio.title asc</code></pre>
				<h4><span class="mw-headline" id="Lost_report_.28no_links.29">Lost report (no links)</span></h4>
				<p>Notes: Modified Items Lost report, includes call# & # of checkouts</p>
				<pre><code class="language-sql">SELECT biblio.title, biblio.author, authorised_values.lib as 'Lost Code', items.barcode,  items.itemcallnumber,  items.datelastseen, items.price, items.homebranch as 'Library',  items.holdingbranch, items.itemnotes, items.issues as 'Checkouts'
FROM items 
LEFT JOIN biblio on (items.biblionumber = biblio.biblionumber)   
LEFT JOIN authorised_values ON (items.itemlost=authorised_values.authorised_value) 
WHERE  items.homebranch = &lt;&lt;Select your library|branches&gt;&gt;
AND items.itemlost != 0
AND authorised_values.category='LOST'
ORDER BY biblio.title asc</code></pre>
			<h3><span class="mw-headline" id="Circulation">Circulation</span></h3>
				<h4><span class="mw-headline" id="Average_circs_each_hour">Average circs each hour</span></h4>
				<p>Notes: Averages how many circulations occured each hour in a date range at a specific library. Can be used to locate your busiest times of day in terms of checkouts.</p>
				<pre><code class="language-sql">SELECT date_format(`datetime`,'%H') as 'Hour', count(*) as 'Checkouts and Renews' 
FROM statistics
WHERE datetime BETWEEN &lt;&lt;Starting date|date&gt;&gt; AND &lt;&lt;Ending date|date&gt;&gt;
	AND branch=&lt;&lt;Choose your library|branches&gt;&gt;
	AND type in ('issue','renew')
GROUP BY date_format(`datetime`,'%H')</code></pre>
				<h4><span class="mw-headline" id="Titles_with_holds">Titles with holds</span></h4>
				<p>Notes: Gives a complete list of bibs with holds including the title, number of holds, and number of items associated with each bib.</p>
				<pre><code class="language-sql">SELECT biblio.biblionumber, biblio.title, biblio.author, authorised_values.lib as collection, count(DISTINCT reserves.borrowernumber) as reservecount, count(DISTINCT items.itemnumber) as itemcount
FROM reserves
LEFT JOIN items ON items.biblionumber=reserves.biblionumber 
LEFT JOIN biblio ON reserves.biblionumber=biblio.biblionumber
LEFT JOIN authorised_values ON items.ccode=authorised_values.authorised_value
GROUP BY reserves.biblionumber
ORDER BY reservecount DESC</code></pre>
				<h4><span class="mw-headline" id="Top_10_Circulating_Items_by_Shelf_Location">Top 10 Circulating Items by Shelf Location</span></h4>
				<p>Notes: Reports the 10 most circulated items in a shelf location in a date range.</p>
				<pre><code class="language-sql">SELECT count(o.issuedate) AS circs, CONCAT('<a href=\"/cgi-bin/koha/catalogue/detail.pl?biblionumber=',b.biblionumber,'\">',title,'</a>') AS Title, b.author
FROM old_issues o
LEFT JOIN items i ON (i.itemnumber=o.itemnumber) 
LEFT JOIN biblio b ON (b.biblionumber=i.biblionumber) 
WHERE DATE(o.issuedate) > &lt;&lt;Range start date|date&gt;&gt; 
	AND DATE(o.issuedate) &lt;= &lt;&lt;Range end date|date&gt;&gt; 
	AND i.homebranch = &lt;&lt;Library|branches&gt;&gt;
	AND i.location = &lt;&lt;Shelf location|LOC&gt;&gt;
	AND o.itemnumber IS NOT NULL
GROUP BY b.biblionumber
ORDER BY circs DESC 
LIMIT 10</code></pre>
			<h3><span class="mw-headline" id="Collection_Analysis">Collection Analysis</span></h3>
				<h4><span class="mw-headline" id="Age_stats_from_call.23_range">Age stats from call# range</span></h4>
				<p>Notes: Shows the average age of the books in a call range based on publication dates. Useful for weeding and collection development.</p>
				<pre><code class="language-sql">SELECT AVG(copyrightdate)
FROM biblio
LEFT JOIN items ON biblio.biblionumber=items.biblionumber 
WHERE items.itemcallnumber BETWEEN &lt;&lt;starting call number&gt;&gt; AND &lt;&lt;ending call number&gt;&gt;
	AND items.homebranch LIKE &lt;&lt;Select Library|branches&gt;&gt;
	AND biblio.copyrightdate IS NOT NULL</code></pre>
				<h4><span class="mw-headline" id="Items_with_subject_of_.27Christian_Fiction.27">Items with subject of 'Christian Fiction'</span></h4>
				<p>Notes: Finds all items associated with records that have a 650a of Christian Fiction. Useful for breaking a collection into a new shelf location.</p>
				<pre><code class="language-sql">SELECT items.barcode, items.itemcallnumber, items.location, biblio.title, biblio.author, ExtractValue( biblioitems.marcxml, '//datafield[@tag="650"]/subfield[@code="a"]' ) AS 'lcsh'
FROM biblioitems
JOIN biblio ON ( biblioitems.biblionumber = biblio.biblionumber )
JOIN items ON ( biblioitems.biblionumber = items.biblionumber )
WHERE items.homebranch = &lt;&lt;Library|branches&gt;&gt;
	AND ExtractValue( biblioitems.marcxml, '//datafield[@tag="650"]/subfield[@code="a"]' ) LIKE '%Christian fiction%'</code></pre>
				<h4><span class="mw-headline" id="Items_with_subject_of_.27Graphic_Novel.27">Items with subject of 'Graphic Novel'</span></h4>
				<p>Notes: Finds all items associated with records that have a 650a of Graphic Novel. Useful for breaking a collection into a new shelf location.</p>
				<pre><code class="language-sql">SELECT items.itemcallnumber, biblio.biblionumber, biblio.title, biblio.author, ExtractValue( biblioitems.marcxml, '//datafield[@tag="650"]/subfield[@code="a"]' ) AS 'lcsh'
FROM biblioitems
JOIN biblio ON ( biblioitems.biblionumber = biblio.biblionumber )
JOIN items ON ( biblioitems.biblionumber = items.biblionumber )
WHERE items.homebranch = &lt;&lt;Library|branches&gt;&gt;
	AND ExtractValue( biblioitems.marcxml, '//datafield[@tag="650"]/subfield[@code="a"]' ) LIKE '%Graphic novel%'</code></pre>
				<h4><span class="mw-headline" id="Link_tracker">Link tracker</span></h4>
				<p>Notes: Counts how many times each 856u is clicked</p>
				<pre><code class="language-sql">SELECT  MAX(timeclicked) AS 'Most Recent Click', url, COUNT(*) as Clicks
FROM linktracker
GROUP BY url
ORDER BY MAX(timeclicked)</code></pre>
			<h3><span class="mw-headline" id="Database_Clean-Up">Database Clean-Up</span></h3>
				<h4><span class="mw-headline" id="Bad_Cataloging">Bad Cataloging</span></h4>
				<p>Notes: Runs comparisons on various authorized values to locate miscataloged items</p>
				<pre><code class="language-sql">SELECT i.barcode, b.title, i.ccode, a.lib, i.homebranch, i.dateaccessioned, i.booksellerid AS Whodunnit
FROM items i
LEFT JOIN biblio b ON i.biblionumber=b.biblionumber
LEFT JOIN authorised_values a ON i.location=a.authorised_value
WHERE (i.location NOT LIKE '%STORED%' AND i.location NOT LIKE '%ILL%' AND i.location NOT LIKE '%NEW%'  AND i.location NOT LIKE '%BKDISCUSS%' AND i.location NOT LIKE '%OFFICE%' AND i.location NOT LIKE '%KSHC%' AND i.location NOT LIKE '%COMPUSE%' AND i.location NOT LIKE '%DISPLAY%' AND i.location NOT LIKE '%ERYBODY%' AND i.location NOT LIKE '%LEASED%' AND i.location NOT LIKE '%SRAREA%' AND i.location NOT LIKE '%GAMEPUZ%')
	AND ((i.ccode LIKE 'AB' AND i.location NOT BETWEEN '100100ADFICCF' AND '121800YAREF') 
		OR (i.ccode LIKE 'AUD' AND i.location NOT LIKE '%AUD%')
		OR (i.ccode LIKE 'BLU' AND i.location NOT LIKE '%BLU%')
		OR (i.ccode LIKE 'DEF')
		OR (i.ccode LIKE 'DVD' AND i.location NOT LIKE '%DVD%')
		OR (i.ccode LIKE 'ER' AND i.location NOT LIKE '%ER%')
		OR (i.ccode LIKE 'GAM' AND i.location NOT LIKE '%SOF%')
		OR (i.ccode LIKE 'ILL' AND i.location NOT LIKE '%ILL%')
		OR (i.ccode LIKE 'JB' AND i.location NOT BETWEEN '140100JUVFICBR' AND '160400JUVNFILL')
		OR (i.ccode LIKE 'MIC' AND i.location NOT LIKE '%MICRO%')
		OR (i.ccode LIKE 'MUS' AND i.location NOT LIKE '%AUDM%')
		OR (i.ccode LIKE 'PER' AND i.location NOT LIKE '%MAG%')
		OR (i.ccode LIKE 'SOF' AND i.location NOT LIKE '%SOF%')
		OR (i.ccode LIKE 'STT')
		OR (i.ccode LIKE 'VHS' AND i.location NOT LIKE '%VHS%')
		OR (i.ccode LIKE 'XXX'))
ORDER BY a.lib</code></pre>
				<h4><span class="mw-headline" id="Bibs_added_in_a_time_frame">Bibs added in a time frame</span></h4>
				<p>Notes: Pulls all bibs created within a selected window of time</p>
				<pre><code class="language-sql">SELECT b.biblionumber, b.title, b.author, ExtractValue(marcxml,'//datafield[@tag="300"]/subfield[@code>="a"]') AS Description,  b.datecreated, b.timestamp
FROM biblioitems bi
LEFT JOIN biblio b on (bi.biblionumber=b.biblionumber) 
WHERE b.datecreated BETWEEN &lt;&lt;Between|date&gt;&gt; AND &lt;&lt;and|date&gt;&gt; 
ORDER BY b.datecreated ASC</code></pre>
				<h4><span class="mw-headline" id="Bibs_with_duplicate_ISBNs">Bibs with duplicate ISBNs</span></h4>
				<p>Notes: Finds cases where multiple records have the same ISBN and links to a search for them. Used to find records to merge.</p>
				<pre><code class="language-sql">SELECT CONCAT('<a href=\"/cgi-bin/koha/catalogue/search.pl?q=',isbn,'\" target="_blank">',isbn,'</a>') AS 'ISBN Search', COUNT(*) AS 'No. of Matching Records'
FROM biblioitems
GROUP BY isbn
HAVING COUNT(*) > 1</code></pre>
				<h4><span class="mw-headline" id="Bibs_with_many_items">Bibs with many items</span></h4>
				<p>Notes: Finds bibs with more than X amount of items. Useful for finding records that are bogged down, esp. periodicals.</p>
				<pre><code class="language-sql">SELECT biblio.biblionumber, title, author, count(*)
FROM items, biblio
WHERE biblio.biblionumber=items.biblionumber
GROUP BY biblio.biblionumber having count(*) > &lt;&lt;# of items/bib&gt;&gt;
ORDER BY count(*) DESC</code></pre>
				<h4><span class="mw-headline" id="Deleted_items_for_specific_bib">Deleted items for specific bib</span></h4>
				<p>Notes: Useful for re-adding items that accidentally get deleted</p>
				<pre><code class="language-sql">SELECT *
FROM deleteditems
LEFT JOIN biblio USING (biblionumber)
WHERE biblionumber = &lt;&lt;Enter Bib Number&gt;&gt;</code></pre>
				<h4><span class="mw-headline" id="Empty_bibs">Empty bibs</span></h4>
				<p>Notes: Bibs without items attached</p>
				<pre><code class="language-sql">SELECT biblionumber, title, datecreated 
FROM biblio 
WHERE biblionumber NOT IN (SELECT biblionumber FROM items)</code></pre>
				<h4><span class="mw-headline" id="Items_without_replacement_prices_filtered_on_shelf_location">Items without replacement prices filtered on shelf location</span></h4>
				<p>Notes: Pulls any legacy data from the 541 field to speed up cleanup</p>
				<pre><code class="language-sql">SELECT i.barcode, i.itemcallnumber, b.author, b.title, i.replacementprice, ExtractValue(bi.marcxml, "//datafield[@tag='541']/subfield[@code='a']" ) AS 'Source', ExtractValue(bi.marcxml, "//datafield[@tag='541']/subfield[@code='d']" ) AS 'Date', ExtractValue(bi.marcxml, "//datafield[@tag='541']/subfield[@code='f']" ) AS 'Owner', ExtractValue(bi.marcxml, "//datafield[@tag='541']/subfield[@code='h']" ) AS 'Purchase Price'
FROM items i
LEFT JOIN biblio b ON (i.biblionumber=b.biblionumber)
LEFT JOIN biblioitems bi ON (i.biblionumber=bi.biblionumber)
WHERE i.homebranch = &lt;&lt;Library|branches&gt;&gt;
	AND i.location = &lt;&lt;Shelf Location|LOC&gt;&gt;
	AND i.ccode <> 'ILL'
	AND i.ccode <> 'ROT'
	AND b.title NOT LIKE '%Floating playaway%'
	AND i.replacementprice IS NULL
ORDER BY i.itemcallnumber</code></pre>
				<h4><span class="mw-headline" id="Multi-null_report_-_hyperlinked">Multi-null report - hyperlinked</span></h4>
				<p>Notes: Checks for null shelf locations, itypes, ccodes and barcodes</p>
				<pre><code class="language-sql">SELECT  CONCAT('<a target="_blank" href=\"/cgi-bin/koha/cataloguing/additem.pl?op=edititem&biblionumber=',biblio.biblionumber,'&itemnumber=',items.itemnumber,'\">',barcode,'</a>') AS Barcode, items.homebranch, items.holdingbranch, items.itemcallnumber, items.location, items.ccode, items.itype,  CONCAT('<a target="_blank" href=\"/cgi-bin/koha/catalogue/detail.pl?biblionumber=',biblio.biblionumber,'\">',title,'</a>') AS Title, biblio.author 
FROM items  
LEFT JOIN biblioitems on (items.biblioitemnumber=biblioitems.biblioitemnumber) 
LEFT JOIN biblio on (biblioitems.biblionumber=biblio.biblionumber)   
WHERE items.location IS NULL OR items.ccode IS NULL OR items.itype IS NULL OR items.barcode IS NULL
	AND items.homebranch <> 'STATELIB'
	AND items.itype <> 'EBOOK'
ORDER BY items.homebranch</code></pre>
				<h4><span class="mw-headline" id="RDA_Framework_Check">RDA Framework Check</span></h4>
				<p>Notes: Finds records with RDA conventions that aren't in the RDA framework</p>
				<pre><code class="language-sql">SELECT CONCAT('<a href=\"/cgi-bin/koha/catalogue/detail.pl?biblionumber=',biblio.biblionumber,'\">',biblio.biblionumber,'</a>') AS biblionumber, items.barcode, items.homebranch, ExtractValue(marcxml, '//datafield[@tag="260"]/subfield[@code="c"]') AS '260c', ExtractValue(marcxml, '//datafield[@tag="264"]/subfield[@code="c"]') AS '264c', biblio.frameworkcode, items.dateaccessioned
FROM biblioitems
JOIN biblio USING (biblionumber)
JOIN items USING (biblionumber)
WHERE biblio.frameworkcode <> 'RDA'
	AND ExtractValue(marcxml, '//datafield[@tag="264"]/subfield[@code="c"]') > 0</code></pre>
			<h3><span class="mw-headline" id="Inventory">Inventory</span></h3>
				<h4><span class="mw-headline" id="Items_not_scanned_in_a_shelf_location">Items not scanned in a shelf location</span></h4>
				<p>Notes: Generates a list of everything that wasn't seen when scanning based on the date inventoried. Use to search for missing items.</p>
				<pre><code class="language-sql">SELECT i.itemcallnumber, b.title, b.author, i.barcode, datelastseen, a.lib, i.onloan
FROM biblio b
LEFT JOIN items i USING (biblionumber)
LEFT JOIN issues c ON (i.itemnumber=c.itemnumber) 
LEFT JOIN borrowers p ON (p.borrowernumber=c.borrowernumber)
LEFT JOIN authorised_values a ON (a.authorised_value=i.itemlost)
WHERE datelastseen &lt; &lt;&lt;Date you started inventory/Date last seen before|date&gt;&gt; 
	AND i.homebranch=&lt;&lt;Home branch|branches&gt;&gt;
	AND i.location=&lt;&lt;Location|LOC&gt;&gt;
	AND i.onloan IS NULL
	AND a.category='LOST'
GROUP BY i.itemnumber
ORDER BY onloan DESC, i.itemcallnumber ASC</code></pre>
				<h4><span class="mw-headline" id="Items_not_scanned">Items not scanned</span></h4>
				<p>Notes: Generates a complete list of items not scanned during inventory, best run at the very end using the inital start date.</p>
				<pre><code class="language-sql">SELECT i.itemcallnumber, b.title, i.barcode, datelastseen, a.lib
FROM biblio b
LEFT JOIN items i USING (biblionumber)
LEFT JOIN issues c ON (i.itemnumber=c.itemnumber) 
LEFT JOIN borrowers p ON (p.borrowernumber=c.borrowernumber)
LEFT JOIN authorised_values a ON (a.authorised_value=i.itemlost)
WHERE datelastseen &lt; &lt;&lt;Date you started inventory/Date last seen before|date&gt;&gt; 
	AND i.homebranch=&lt;&lt;Home branch|branches&gt;&gt;
	AND i.onloan IS NULL
	AND a.category='LOST'
GROUP BY i.itemnumber
ORDER BY onloan DESC, i.itemcallnumber ASC</code></pre>
			<h3><span class="mw-headline" id="Monthly">Monthly</span></h3>
				<h4><span class="mw-headline" id="Long_overdues_AT_other_libraries">Long overdues AT other libraries</span></h4>
				<p>Notes: Overdue items that are owned by your library, but checked out elsewhere. Enter your library twice. Suggested action: check your shelf, check in if found; if not found, work with "Checked out at" library</p>
				<pre><code class="language-sql">SELECT items.barcode, biblio.title, items.itemcallnumber, items.homebranch AS "Owned by", issues.date_due, items.holdingbranch AS "Checked out at" 
FROM items 
LEFT JOIN  biblio on(items.biblionumber=biblio.biblionumber) 
LEFT JOIN  issues on(items.itemnumber=issues.itemnumber) 
LEFT JOIN  borrowers on(issues.borrowernumber=borrowers.borrowernumber) 
WHERE  items.homebranch = &lt;&lt;Select Your Library|branches&gt;&gt;
	AND  items.holdingbranch != &lt;&lt;Select Your Library (again)|branches&gt;&gt;
	AND  issues.date_due != ' '
	AND  issues.date_due is not NULL 
	AND  issues.date_due &lt; DATE_SUB(curdate(), INTERVAL '99' DAY)  
ORDER BY  items.holdingbranch</code></pre>
				<h4><span class="mw-headline" id="Long_overdues_FROM_other_libraries">Long overdues FROM other libraries</span></h4>
				<p>Notes: Overdue items that are owned by someone else, but checked out by your patron. Enter your library twice. Suggested action: check your shelves, check in if found; if not found, pursue patron</p>
				<pre><code class="language-sql">SELECT borrowers.cardnumber,  borrowers.firstname,  borrowers.surname,  borrowers.phone,  borrowers.email, items.barcode, biblio.title, items.itemcallnumber, items.homebranch AS "Owned by", issues.date_due, items.holdingbranch AS "Checked out at" 
FROM items 
LEFT JOIN  biblio on(items.biblionumber=biblio.biblionumber) 
LEFT JOIN  issues on(items.itemnumber=issues.itemnumber) 
LEFT JOIN  borrowers on(issues.borrowernumber=borrowers.borrowernumber) 
WHERE  items.homebranch != &lt;&lt;Select Your Library|branches&gt;&gt;
	AND  items.holdingbranch = &lt;&lt;Select Your Library (again)|branches&gt;&gt;
	AND  items.homebranch <> 'ROTATION'
	AND  issues.date_due != <i> </i>
	AND  issues.date_due is not NULL 
	AND  issues.date_due &lt; DATE_SUB(curdate(), INTERVAL '99' DAY)  
ORDER BY  items.homebranch</code></pre>
				<h4><span class="mw-headline" id="Lost_items_AT_other_libraries">Lost items AT other libraries</span></h4>
				<p>Notes: Items that were marked lost with a holding location different than the home location. Suggested action: Determine if the item was paid for. If yes, delete. If no, pursue.</p>
				<pre><code class="language-sql">SELECT items.itemnumber, biblio.title, biblio.author, items.itemcallnumber, items.barcode, authorised_values.lib , items.homebranch, items.holdingbranch
FROM items 
LEFT JOIN biblio ON (items.biblionumber=biblio.biblionumber) 
LEFT JOIN authorised_values ON (items.itemlost=authorised_values.authorised_value) 
WHERE items.itemlost <> '0' AND items.itemlost <> '2' AND authorised_values.category='LOST'
	AND items.homebranch <> items.holdingbranch
	AND items.homebranch = &lt;&lt;Your library|branches&gt;&gt;
ORDER BY items.holdingbranch</code></pre>
				<h4><span class="mw-headline" id="Missing_call_number">Missing call number</span></h4>
				<p>Notes: Items at a specified library without call numbers Suggested action: Add the appropriate call number to these items.</p>
				<pre><code class="language-sql">SELECT CONCAT('<a target="_blank" href=\"/cgi-bin/koha/cataloguing/additem.pl?op=edititem&biblionumber=',biblio.biblionumber,'&itemnumber=',items.itemnumber,'\">',barcode,'</a>') AS Barcode, items.itemcallnumber, CONCAT('<a target="_blank" href=\"/cgi-bin/koha/catalogue/detail.pl?biblionumber=',biblio.biblionumber,'\">',title,'</a>') AS Title, biblio.author 
FROM items  
LEFT JOIN biblioitems on (items.biblioitemnumber=biblioitems.biblioitemnumber) 
LEFT JOIN biblio on (biblioitems.biblionumber=biblio.biblionumber)   
WHERE items.itemcallnumber IS NULL
	AND items.homebranch = &lt;&lt;Choose Library|branches&gt;&gt;
ORDER BY items.itemcallnumber</code></pre>
				<h4><span class="mw-headline" id="Missing_collection_code">Missing collection code</span></h4>
				<p>Notes: Items at a specified library missing a collection code</p>
				<pre><code class="language-sql">SELECT CONCAT('<a target="_blank" href=\"/cgi-bin/koha/cataloguing/additem.pl?op=edititem&biblionumber=',biblio.biblionumber,'&itemnumber=',items.itemnumber,'\">',barcode,'</a>') AS Barcode, items.itemcallnumber, items.ccode, CONCAT('<a target="_blank" href=\"/cgi-bin/koha/catalogue/detail.pl?biblionumber=',biblio.biblionumber,'\">',title,'</a>') AS Title, biblio.author 
FROM items  
LEFT JOIN biblioitems on (items.biblioitemnumber=biblioitems.biblioitemnumber) 
LEFT JOIN biblio on (biblioitems.biblionumber=biblio.biblionumber)   
WHERE items.ccode IS NULL
	AND items.homebranch = &lt;&lt;Choose Library|branches&gt;&gt;
ORDER BY items.itemcallnumber</code></pre>
				<h4><span class="mw-headline" id="Missing_item_type">Missing item type</span></h4>
				<p>Notes: Items at a specified library missing an item type</p>
				<pre><code class="language-sql">SELECT CONCAT('<a target="_blank" href=\"/cgi-bin/koha/cataloguing/additem.pl?op=edititem&biblionumber=',biblio.biblionumber,'&itemnumber=',items.itemnumber,'\">',barcode,'</a>') AS Barcode, items.itemcallnumber, items.itype, CONCAT('<a target="_blank" href=\"/cgi-bin/koha/catalogue/detail.pl?biblionumber=',biblio.biblionumber,'\">',title,'</a>') AS Title, biblio.author 
FROM items  
LEFT JOIN biblioitems on (items.biblioitemnumber=biblioitems.biblioitemnumber) 
LEFT JOIN biblio on (biblioitems.biblionumber=biblio.biblionumber)   
WHERE items.itype IS NULL
	AND items.homebranch = &lt;&lt;Choose Library|branches&gt;&gt;
ORDER BY items.itemcallnumber</code></pre>
				<h4><span class="mw-headline" id="Missing_shelf_location">Missing shelf location</span></h4>
				<p>Notes: Items at a specified library missing a shelf location</p>
				<pre><code class="language-sql">SELECT CONCAT('<a target="_blank" href=\"/cgi-bin/koha/cataloguing/additem.pl?op=edititem&biblionumber=',biblio.biblionumber,'&itemnumber=',items.itemnumber,'\">',barcode,'</a>') AS Barcode, items.itemcallnumber, items.location, CONCAT('<a target="_blank" href=\"/cgi-bin/koha/catalogue/detail.pl?biblionumber=',biblio.biblionumber,'\">',title,'</a>') AS Title, biblio.author 
FROM items  
LEFT JOIN biblioitems on (items.biblioitemnumber=biblioitems.biblioitemnumber) 
LEFT JOIN biblio on (biblioitems.biblionumber=biblio.biblionumber)   
WHERE items.location IS NULL
	AND items.homebranch = &lt;&lt;Choose Library|branches&gt;&gt;
ORDER BY items.itemcallnumber</code></pre>
				<h4><span class="mw-headline" id="Old_holds">Old holds</span></h4>
				<p>Notes: Holds placed XX months ago or more</p>
				<pre><code class="language-sql">SELECT CONCAT('<a target="_blank" href=\"/cgi-bin/koha/circ/circulation.pl?borrowernumber=',p.borrowernumber,'\">',p.borrowernumber,'</a>') AS 'Link to Patron', p.cardnumber, p.firstname, p.surname, r.reservedate, b.title
FROM reserves r
LEFT JOIN borrowers p USING (borrowernumber)
LEFT JOIN biblio b USING (biblionumber)
WHERE r.reservedate &lt; ADDDATE(NOW(), INTERVAL -&lt;&lt;Holds over (XX) months old&gt;&gt; MONTH)
	AND r.branchcode = &lt;&lt;Select your library|branches&gt;&gt;     
ORDER BY r.reservedate</code></pre>
				<h4><span class="mw-headline" id="Transfers_FROM_your_library">Transfers FROM your library</span></h4>
				<p>Notes: Transfers being sent from your library that have not arrived yet</p>
				<pre><code class="language-sql">SELECT  b.datesent, b.frombranch, b.tobranch, items.homebranch, items.barcode, biblio.title, biblio.author, items.itemcallnumber, DATEDIFF(b.datesent, (DATE_SUB(curdate(), INTERVAL 5 day)) ) * -1 as dayslate
FROM branchtransfers as b
LEFT JOIN items on (b.itemnumber = items.itemnumber)
LEFT JOIN biblioitems on (biblioitems.biblioitemnumber = items.biblioitemnumber)
LEFT JOIN biblio on (biblio.biblionumber = biblioitems.biblionumber)
WHERE b.frombranch = &lt;&lt;Select your library|branches&gt;&gt;
	AND b.datearrived is NULL
	AND items.homebranch <> 'ROTATION'
	AND DATEDIFF(b.datesent, (DATE_SUB(curdate(), INTERVAL 5 day)) ) * -1 > '0'
ORDER BY dayslate DESC</code></pre>
				<h4><span class="mw-headline" id="Transfers_TO_your_library">Transfers TO your library</span></h4>
				<p>Notes: Transfers being sent to your library that have not arrived yet</p>
				<pre><code class="language-sql">SELECT  b.datesent, b.frombranch, b.tobranch, items.homebranch, items.barcode, biblio.title, biblio.author, items.itemcallnumber, DATEDIFF(b.datesent, (DATE_SUB(curdate(), INTERVAL 5 day)) ) * -1 as dayslate
FROM branchtransfers as b
LEFT JOIN items on (b.itemnumber = items.itemnumber)
LEFT JOIN biblioitems on (biblioitems.biblioitemnumber = items.biblioitemnumber)
LEFT JOIN biblio on (biblio.biblionumber = biblioitems.biblionumber)
WHERE b.tobranch = &lt;&lt;Select your library|branches&gt;&gt;
	AND b.datearrived is NULL
	AND items.homebranch <> 'ROTATION'
	AND DATEDIFF(b.datesent, (DATE_SUB(curdate(), INTERVAL 5 day)) ) * -1 > '0'
ORDER BY dayslate DESC</code></pre>
			<h3><span class="mw-headline" id="Patrons">Patrons</span></h3>
				<h4><span class="mw-headline" id="Patrons_without_cardnumber">Patrons without cardnumber</span></h4>
				<p>Notes: Finds patrons with blank cardnumbers, useful for self-registration cleanup.</p>
				<pre><code class="language-sql">SELECT surname as 'Surname', firstname as 'First Name', dateexpiry as 'Expiry Date', branchcode as 'Library'
FROM borrowers 
WHERE (cardnumber = ' ' OR cardnumber IS NULL)
ORDER BY branchcode, surname asc
LIMIT 100</code></pre>
				<h4><span class="mw-headline" id="Patrons_added_in_date_range">Patrons added in date range</span></h4>
					<p>Notes: Counts patrons added in date range at selected library.</p>
				<pre><code class="language-sql">SELECT categorycode, COUNT(branchcode) as 'New Patrons Added' 
FROM borrowers 
WHERE borrowers.dateenrolled BETWEEN &lt;&lt;Patrons added between|date&gt;&gt; AND &lt;&lt;and|date&gt;&gt;
	AND borrowers.branchcode=&lt;&lt;Your branch|branches&gt;&gt;
GROUP BY branchcode, categorycode</code></pre>
			<h3><span class="mw-headline" id="Year-End">Year-End</span></h3>
				<h4><span class="mw-headline" id="Yearly_circulation_stats_by_collection_code">Yearly circulation stats by collection code</span></h4>
				<p>Notes: Gives total checkouts + renewals in a year, broken down by ccode, with a grand total at the end.</p>
				<pre><code class="language-sql">SELECT a.lib AS 'Collection Code', COUNT(1) AS 'Circs'
FROM statistics s
LEFT JOIN items i ON s.itemnumber=i.itemnumber
LEFT JOIN authorised_values a ON i.ccode=a.authorised_value
WHERE YEAR(s.datetime) = &lt;&lt;Enter year (YYYY)&gt;&gt;
	AND s.branch = &lt;&lt;Select Library|branches&gt;&gt;
	AND s.type IN ('issue', 'renew')
GROUP BY a.lib
UNION ALL
SELECT 'TOTAL' ccode, COUNT(1) AS 'Circs'
FROM statistics
WHERE YEAR(datetime) = &lt;&lt;Enter Year Again (YYYY)&gt;&gt;
	AND branch = &lt;&lt;Select Library Again|branches&gt;&gt;
	AND type IN ('issue', 'renew')</code></pre>
				<h4><span class="mw-headline" id="Patron_count_by_patron_category">Patron count by patron category</span></h4>
				<p>Notes: Totals number of patrons in each category at a selected library with a grand total at the end.</p>
				<pre><code class="language-sql">SELECT c.description AS 'Patron Category', COUNT(*)
FROM borrowers b
LEFT JOIN categories c ON (b.categorycode = c.categorycode)
WHERE b.branchcode = &lt;&lt;Choose Library|branches&gt;&gr;
GROUP BY b.categorycode
UNION ALL
SELECT 'TOTAL' categories, COUNT(*)
FROM borrowers
WHERE branchcode = &lt;&lt;Choose Library Again|branches&gt;&gt;</code></pre>
				<h4><span class="mw-headline" id="Item_count_by_collection_code">Item count by collection code</span></h4>
				<p>Notes: Gives total number of items in each collection code with a grand total at the end.</p>
				<pre><code class="language-sql">SELECT authorised_values.lib AS 'Collection Code', COUNT(1) AS Count
FROM items
LEFT JOIN authorised_values ON (items.ccode=authorised_values.authorised_value)
WHERE items.homebranch = &lt;&lt;Choose Library|branches&gt;&gt;
GROUP BY items.ccode
UNION ALL
SELECT 'TOTAL' ccode, COUNT(1)
FROM items
WHERE homebranch = &lt;&lt;Choose Library|branches&gt;&gt;</code></pre>
				<h4><span class="mw-headline" id="Item_count_by_shelf_location">Item count by shelf location</span></h4>
				<p>Notes: Gives total number of items in each shelf location with a grand total at the end.</p>
				<pre><code class="language-sql">SELECT authorised_values.lib AS 'Shelving Location', COUNT(1) AS Count
FROM items
LEFT JOIN authorised_values ON (items.location=authorised_values.authorised_value)
WHERE items.homebranch = &lt;&lt;Choose Library|branches&gt;&gt;
GROUP BY items.location
UNION ALL
SELECT 'TOTAL' location, COUNT(1)
FROM items
WHERE homebranch = &lt;&lt;Choose Library|branches&gt;&gt;
LIMIT 100</code></pre>
				<h4><span class="mw-headline" id="Loans_to_libraries_outside_the_consortium">Loans to libraries outside the consortium</span></h4>
				<p>Notes: Counts checkouts to patrons with the ILL category</p>
				<pre><code class="language-sql">SELECT COUNT(*) AS 'Loans'
FROM statistics s
JOIN borrowers b USING (borrowernumber) 
WHERE b.categorycode = 'ILL'
	AND s.type IN ('issue','renew') 
	AND s.branch = &lt;&lt;Choose Your Library|branches&gt;&gt;
	AND YEAR(s.datetime) = &lt;&lt;Enter Year (YYYY)&gt;&gt;</code>	</pre>
				<h4><span class="mw-headline" id="Borrows_from_libraries_outside_the_consortium">Borrows from libraries outside the consortium</span></h4>
				<p>Notes: Counts checkouts of ILL cards used to circulate non-consortium items to consortium patrons</p>
				<pre><code class="language-sql">SELECT COUNT(*) AS 'Borrows'
FROM statistics s
JOIN items i USING (itemnumber) 
WHERE i.ccode = 'ILL'
	AND s.type IN ('issue','renew') 
	AND s.branch = &lt;&lt;Choose Your Library|branches&gt;&gt;
	AND YEAR(s.datetime) = &lt;&lt;Enter Year (YYYY)&gt;&gt;</code>	</pre>
				<h4><span class="mw-headline" id="Circulation_of_Juv.2FYA_materials_in_given_year">Circulation of Juv/YA materials in given year</span></h4>
				<p>Notes: Sums circs for each shelf location with a grand total at the end.</p>
				<pre><code class="language-sql">SELECT COALESCE(a.lib, 'TOTAL') AS 'Shelf Location',  COUNT(*) AS 'Circs' 
FROM statistics s
LEFT JOIN items i ON (s.itemnumber=i.itemnumber)
LEFT JOIN authorised_values a ON (i.location=a.authorised_value)
WHERE 1=1  
	AND YEAR(s.datetime) = &lt;&lt;Year (YYYY)&gt;&gt;
	AND s.branch LIKE &lt;&lt;Home branch|branches&gt;&gt;
	AND s.type IN ('issue', 'renew')
	AND (i.location LIKE '%YA%'  OR  i.location LIKE '%JUV%')
GROUP BY a.lib
WITH ROLLUP
LIMIT 50</code></pre>
    	</div><!-- /.reportslibrary -->
	</div><!-- /.container -->
	<footer>
    	<ul>
       		<li><a href="mailto:jrobb@sekls.org">email me</a></li>
       		<li><a href="https://www.seknfind.org/">Visit SEKnFind</a></li>
		</ul>
	</footer>
	<script src="js/prism.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
	</body>
</html>
